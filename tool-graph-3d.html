<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3Dグラフ | Mcommon Study</title>
    <link rel="stylesheet" href="/css/style.css" />
    <!-- Plotly (3D描画用) -->
    <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>

    <style>
      .graph-page {
        padding-top: calc(var(--header-height) + var(--space-lg));
        padding-bottom: var(--space-xl);
      }

      .graph-card {
        max-width: 960px;
        margin: 0 auto var(--space-xl);
      }

      .graph-form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: var(--space-sm);
        margin-top: var(--space-sm);
      }

      .graph-row {
        display: flex;
        flex-wrap: wrap;
        gap: var(--space-sm);
        align-items: center;
        margin-top: var(--space-sm);
      }

      .graph-row .form-input,
      .graph-row input,
      .graph-row select {
        flex: 1 1 0;
      }

      .graph-help {
        font-size: var(--fz-xs);
        color: var(--text-muted);
        margin-top: var(--space-xs);
      }

      .graph-mode-panel {
        display: none;
        margin-top: var(--space-md);
      }
      .graph-mode-panel.active {
        display: block;
      }

      #graph3d {
        width: 100%;
        height: 480px;
        margin-top: var(--space-md);
        border-radius: var(--radius-card);
        overflow: hidden;
      }

      #graph-error {
        min-height: 1.5em;
        color: var(--danger);
        font-size: var(--fz-sm);
        margin-top: var(--space-xs);
      }
    </style>
  </head>

  <body>
    <div id="site-header"></div>

    <div class="page">
      <main id="main-content" class="wrapper graph-page">
        <section class="glass-card graph-card">
          <h1 class="section-title">3Dグラフ</h1>
          <p class="muted">
            関数を入力して 3D グラフを描画します。<br />
            <code>sin</code>, <code>cos</code>, <code>tan</code>, <code>exp</code>,
            <code>log</code>, <code>sqrt</code>, <code>abs</code>,
            <code>pi</code>, <code>e</code> が使えます。冪乗は <code>^</code>
            で指定（例: <code>sin(x^2 + y^2)</code>）。
          </p>

          <!-- モード切り替えタブ -->
          <div class="tabs" id="graph-mode-tabs" style="margin-top: var(--space-md);">
            <button type="button" class="active" data-mode="surface">
              z = f(x, y)
            </button>
            <button type="button" data-mode="implicit">
              F(x, y, z) = 0
            </button>
            <button type="button" data-mode="param">
              パラメータ表示
            </button>
          </div>

          <!-- z = f(x,y) -->
          <div class="graph-mode-panel active" data-panel="surface">
            <div class="graph-row">
              <label class="form-label" for="expr-surface">z =</label>
              <input
                id="expr-surface"
                class="form-input"
                placeholder="例: sin(x^2 + y^2) / (x^2 + y^2 + 1)"
                value="sin(x^2 + y^2) / (x^2 + y^2 + 1)"
              />
            </div>
            <div class="graph-form-grid">
              <div>
                <label class="form-label" for="x-min">x 最小</label>
                <input id="x-min" type="number" class="form-input" value="-3" />
              </div>
              <div>
                <label class="form-label" for="x-max">x 最大</label>
                <input id="x-max" type="number" class="form-input" value="3" />
              </div>
              <div>
                <label class="form-label" for="y-min">y 最小</label>
                <input id="y-min" type="number" class="form-input" value="-3" />
              </div>
              <div>
                <label class="form-label" for="y-max">y 最大</label>
                <input id="y-max" type="number" class="form-input" value="3" />
              </div>
            </div>
            <p class="graph-help">
              グリッド数: 35 × 35 固定（重くなるのを避けるため）。
            </p>
          </div>

          <!-- F(x,y,z)=0 -->
          <div class="graph-mode-panel" data-panel="implicit">
            <div class="graph-row">
              <label class="form-label" for="expr-implicit">F(x, y, z) =</label>
              <input
                id="expr-implicit"
                class="form-input"
                placeholder="例: x^2 + y^2 + z^2 - 4   （半径2の球）"
                value="x^2 + y^2 + z^2 - 4"
              />
            </div>
            <div class="graph-form-grid">
              <div>
                <label class="form-label" for="ix-min">x 最小</label>
                <input id="ix-min" type="number" class="form-input" value="-3" />
              </div>
              <div>
                <label class="form-label" for="ix-max">x 最大</label>
                <input id="ix-max" type="number" class="form-input" value="3" />
              </div>
              <div>
                <label class="form-label" for="iy-min">y 最小</label>
                <input id="iy-min" type="number" class="form-input" value="-3" />
              </div>
              <div>
                <label class="form-label" for="iy-max">y 最大</label>
                <input id="iy-max" type="number" class="form-input" value="3" />
              </div>
              <div>
                <label class="form-label" for="iz-min">z 最小</label>
                <input id="iz-min" type="number" class="form-input" value="-3" />
              </div>
              <div>
                <label class="form-label" for="iz-max">z 最大</label>
                <input id="iz-max" type="number" class="form-input" value="3" />
              </div>
            </div>
            <p class="graph-help">
              立体をボクセル状にサンプリングし、|F(x,y,z)| が小さい点だけ散布図として描画します。
            </p>
          </div>

          <!-- パラメータ表示 -->
          <div class="graph-mode-panel" data-panel="param">
            <div class="graph-row">
              <label class="form-label" for="expr-x">x(t) =</label>
              <input
                id="expr-x"
                class="form-input"
                value="cos(t)"
                placeholder="例: cos(t)"
              />
            </div>
            <div class="graph-row">
              <label class="form-label" for="expr-y">y(t) =</label>
              <input
                id="expr-y"
                class="form-input"
                value="sin(t)"
                placeholder="例: sin(t)"
              />
            </div>
            <div class="graph-row">
              <label class="form-label" for="expr-z">z(t) =</label>
              <input
                id="expr-z"
                class="form-input"
                value="t / 4"
                placeholder="例: t / 4"
              />
            </div>
            <div class="graph-form-grid">
              <div>
                <label class="form-label" for="t-min">t 最小</label>
                <input id="t-min" type="number" class="form-input" value="0" />
              </div>
              <div>
                <label class="form-label" for="t-max">t 最大</label>
                <input
                  id="t-max"
                  type="number"
                  class="form-input"
                  value="6.283"
                />
              </div>
            </div>
            <p class="graph-help">
              ステップ数: 300 固定。ヘリックスのような空間曲線も描けます。
            </p>
          </div>

          <div class="graph-row" style="margin-top: var(--space-md);">
            <button class="btn btn-primary" id="graph-run" type="button">
              描画
            </button>
            <button class="btn" id="graph-clear" type="button">
              クリア
            </button>
          </div>

          <p id="graph-error"></p>

          <div id="graph3d"></div>
        </section>
      </main>
    </div>

    <div id="chatbot-slot"></div>
    <div id="site-footer"></div>

    <script src="/js/layout.js"></script>
    <script src="/js/tool-graph-3d.js"></script>
  </body>
</html>
